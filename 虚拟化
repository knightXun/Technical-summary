虚拟化(virtulization)
1千兆 带宽100M

厂商:              pc/服务器代表
VMware             vSphere=esxi+vcenter    esxi=Linux +vmware 需要熟悉sqlserver
RedHat             KVM

ps -efww   查看所有进程 
ps -ef | grep qemu 

安装虚拟化服务器平台

软件包
qemu-kvm :                                 为kvm提供底层仿真支持
libvirt-daemon :                           libvirt守护进程,管理虚拟机
libvirt-client :                           用户端软件,提供客户端管理命令
libvirt-daemon-driver-qemu:                libvirt连接qemu的驱动

virt-install :                              系统安装工具
virt-manager:                               图形管理工具
virt-v2v     :                              虚拟机迁移工具
virt-p2v     :                              物理机迁移工具

systemctl start libvirtd :                   起服务

虚拟机组成:一个XML文件(虚拟机配制声明文件)+        /etc/libvirt/qemu/
          一个磁盘镜像文件(虚拟机的银盘)         /var/lib/libvirt/images/

虚拟机(virsh)管理操作

格式: virsh 选项  主机名

列出所有              virsh list --all
查看基本信息           virsh  dominfo  主机名
启动,停止,重启         satrt|shutdown|reboot
强制关闭              destroy
根据xml文件创建/删除    define|undefine
连接                  console

修改配置               edit
设置开机自启动          autostart
取消开机自启动          autostart --disable
查看网卡信息            domiflist
查看硬盘信息            domblklist

************************************************************************************
 

virsh虚拟网络管理

前面加net-
列出虚拟网络              net-list [--all]
启动虚拟交换机            net-start
强制停止虚拟交换机         net-destroy
根据xml文件创建虚拟网络    net-define
删除一个虚拟网络设备       net-undefine
修改虚拟交换机的配置       net-edit
设置虚拟交换机开机自启      net-autostart




常用磁盘镜像文件格式
特点\类型             RAW           QCOW2:(copy on write 写实复制)
KVM默认               否             是
I/O效率               高             较高
占用空间               大             小
压缩                 不支持           支持
后端盘复用            不支持           支持
快照                 不支持           支持

qemu-img虚拟机的磁盘管理命令,支持raw,qcow2,vdi,vmdk等磁盘格式
格式: qemu-img 命令 参数 快文件名称(磁盘路径)  大小
例子: qemu-img create -f /root/disk.img 50G
常用命令:
创建              create
转换磁盘格式        convert
查看磁盘信息        info 
扩容磁盘空间        resize  

查询镜像盘文件的信息 qemu-img info 磁盘路径
           例子:  qemu-img inf disk.img
-b 指向后端模板文件 qemu-img create -b houduan.img -f qcow2 disk1.img


创建名为ooxx的虚拟机             拷贝配置文件模板
                      cp .node_base.xml      /etc/libvirt/qemu/ooxx.xml
                      2: <name>ooxx</name>
                      26:<source file='/var/lib/libvirt/images/ooxx.img/'>
                      创建虚拟机
                      virsh define /etc/libvirt/qemu/ooxx.xml
                      virsh list --all
                      virsh start ooxx
                      virsh console ooxx
                      

网卡及配置文件
vim  /etc/sysconfig/network-scripts/ifcfg-eth0
# Generated by dracut initrd     注释
DEVICE="eth0"                    驱动名称,与ifconfig看到的名称一致
ONBOOT="yes"                     开机启动
NM_CONTROLLED="no"               不接受NeteorkManger控制
TYPE="Ethernet"                  类型
BOOTPROTO="static"               协议(dhcp|static|none)
PERSISTENT_DHCLIENT="yes"        

IPADDR="192.168.1.100"           ip地址
NETMASK="255.255.255.0"          子网掩码
GAETWAY="192.168.1.254"          默认网关


virsh 扩容磁盘 思路:硬盘-->分区-->文件系统
virsh 虚拟机管理                                     实例: 为ooxx扩容磁盘 
查看虚拟机硬盘信息   domblklist                             virsh domblklist ooxx
                                                          目标     源
                                                          ------------------------------------------------
                                                          vda        /var/lib/libvirt/images/ooxx.img
                                                
blockresize --path [决对路径] --size 50G 主机名     virsh blockresize --path /var/lib/libvirt/images/ooxx.img --size 50G ooxx
根分区扩容:语言必须设置为英文 LANG=C                              LANG=C 
查看硬盘                   lsblk                                          
扩容分区                   /usr/bin/growpart      /磁盘路径     growpart /dev/vda 1
扩容文件系统                /usr/sbin/xfs_growfs   /跟路径       xfs_growfs /
检查                       df -h 


云计算
IaaS:既基础设施即服务
PaaS:平台即服务
SaaS:软件服务

Openstack:是一套IaaS解决方案

查看公网IP 
curl ip.3322.net








